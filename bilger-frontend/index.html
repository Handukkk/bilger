<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BilGer - Share Bill Together</title>
    <style>
        /* Global Styles */
        :root {
            --primary-color: #6366f1;
            --primary-hover: #4f46e5;
            --secondary-color: #a855f7;
            --secondary-hover: #9333ea;
            --success-color: #22c55e;
            --success-hover: #16a34a;
            --danger-color: #ef4444;
            --danger-hover: #dc2626;
            --light-bg: #f9fafb;
            --dark-bg: #111827;
            --light-card: #ffffff;
            --dark-card: #1f2937;
            --light-text: #1f2937;
            --dark-text: #f9fafb;
            --light-border: #e5e7eb;
            --dark-border: #374151;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #eef2ff, #f5f3ff);
            min-height: 100vh;
            color: var(--light-text);
            transition: background-color 0.3s, color 0.3s;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
        }

        .card {
            background-color: var(--light-card);
            border-radius: 16px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            padding: 24px;
            margin-bottom: 24px;
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.12);
        }

        h1 {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
            text-align: center;
            background: linear-gradient(to right, var(--primary-color), var(--secondary-color));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }

        h2 {
            font-size: 1.8rem;
            margin-bottom: 1rem;
            color: var(--light-text);
        }

        h3 {
            font-size: 1.4rem;
            margin-bottom: 0.8rem;
            color: var(--light-text);
        }

        p {
            margin-bottom: 1rem;
            line-height: 1.6;
        }

        .tagline {
            text-align: center;
            font-size: 1.2rem;
            margin-bottom: 2rem;
            color: #6b7280;
        }

        .btn {
            display: inline-block;
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.3s, transform 0.2s;
            border: none;
            text-align: center;
            text-decoration: none;
        }

        .btn:hover {
            transform: translateY(-2px);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-primary {
            background-color: var(--primary-color);
            color: white;
        }

        .btn-primary:hover {
            background-color: var(--primary-hover);
        }

        .btn-secondary {
            background-color: var(--secondary-color);
            color: white;
        }

        .btn-secondary:hover {
            background-color: var(--secondary-hover);
        }

        .btn-success {
            background-color: var(--success-color);
            color: white;
        }

        .btn-success:hover {
            background-color: var(--success-hover);
        }

        .btn-danger {
            background-color: var(--danger-color);
            color: white;
        }

        .btn-danger:hover {
            background-color: var(--danger-hover);
        }

        .btn-back {
            display: flex;
            align-items: center;
            color: var(--primary-color);
            margin-bottom: 1rem;
            font-weight: 600;
            cursor: pointer;
            background: none;
            border: none;
        }

        .btn-back:hover {
            color: var(--primary-hover);
        }

        .btn-back svg {
            margin-right: 0.5rem;
        }

        .grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
        }

        @media (min-width: 768px) {
            .grid-2 {
                grid-template-columns: repeat(2, 1fr);
            }

            .grid-3 {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        .flex {
            display: flex;
        }

        .flex-col {
            flex-direction: column;
        }

        .items-center {
            align-items: center;
        }

        .justify-center {
            justify-content: center;
        }

        .justify-between {
            justify-content: space-between;
        }

        .gap-2 {
            gap: 0.5rem;
        }

        .gap-4 {
            gap: 1rem;
        }

        .gap-6 {
            gap: 1.5rem;
        }

        .w-full {
            width: 100%;
        }

        .text-center {
            text-align: center;
        }

        .mb-2 {
            margin-bottom: 0.5rem;
        }

        .mb-4 {
            margin-bottom: 1rem;
        }

        .mb-6 {
            margin-bottom: 1.5rem;
        }

        .mb-8 {
            margin-bottom: 2rem;
        }

        .mt-4 {
            margin-top: 1rem;
        }

        .mt-6 {
            margin-top: 1.5rem;
        }

        .p-3 {
            padding: 0.75rem;
        }

        .p-4 {
            padding: 1rem;
        }

        .rounded {
            border-radius: 8px;
        }

        .rounded-full {
            border-radius: 9999px;
        }

        .border {
            border: 1px solid var(--light-border);
        }

        .bg-gray-50 {
            background-color: #f9fafb;
        }

        .bg-gray-100 {
            background-color: #f3f4f6;
        }

        .font-bold {
            font-weight: 700;
        }

        .font-medium {
            font-weight: 500;
        }

        .text-sm {
            font-size: 0.875rem;
        }

        .text-lg {
            font-size: 1.125rem;
        }

        .text-xl {
            font-size: 1.25rem;
        }

        .text-2xl {
            font-size: 1.5rem;
        }

        .hidden {
            display: none;
        }

        /* Form Styles */
        .form-group {
            margin-bottom: 1rem;
        }

        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
        }

        .form-input {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 1px solid var(--light-border);
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s, box-shadow 0.3s;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.2);
        }

        /* Item List Styles */
        .item-list {
            max-height: 400px;
            overflow-y: auto;
        }

        .item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem 1rem;
            background-color: #f9fafb;
            border-radius: 8px;
            margin-bottom: 0.5rem;
            transition: background-color 0.3s;
        }

        .item:hover {
            background-color: #f3f4f6;
        }

        .item-name {
            font-weight: 500;
        }

        .item-price {
            font-weight: 600;
        }

        /* Person Styles */
        .person-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.25rem;
            color: white;
            margin-bottom: 0.5rem;
        }

        .person-card {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 1rem;
            border-radius: 12px;
            cursor: pointer;
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .person-card:hover {
            transform: translateY(-5px);
        }

        .person-card.active {
            box-shadow: 0 0 0 3px white, 0 0 0 6px var(--primary-color);
        }

        /* Animation Styles */
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .animate-fade-in {
            animation: fadeIn 0.5s ease forwards;
        }

        /* Page Specific Styles */
        #home-page .option-card {
            height: 250px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: transform 0.3s, border-color 0.3s;
            border: 2px solid transparent;
        }

        #home-page .option-card:hover {
            transform: scale(1.05);
            border-color: var(--primary-color);
        }

        #home-page .option-icon {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 1rem;
        }

        #home-page .scan-icon {
            background-color: #eef2ff;
            color: var(--primary-color);
        }

        #home-page .manual-icon {
            background-color: #f5f3ff;
            color: var(--secondary-color);
        }

        /* Colors for person avatars */
        .bg-red { background-color: #ef4444; }
        .bg-blue { background-color: #3b82f6; }
        .bg-green { background-color: #10b981; }
        .bg-yellow { background-color: #f59e0b; }
        .bg-purple { background-color: #8b5cf6; }
        .bg-pink { background-color: #ec4899; }
        .bg-indigo { background-color: #6366f1; }
        .bg-teal { background-color: #14b8a6; }
        .bg-orange { background-color: #f97316; }
        .bg-cyan { background-color: #06b6d4; }

        /* Light colors for person cards */
        .bg-red-light { background-color: #fee2e2; color: #b91c1c; }
        .bg-blue-light { background-color: #dbeafe; color: #1d4ed8; }
        .bg-green-light { background-color: #dcfce7; color: #15803d; }
        .bg-yellow-light { background-color: #fef3c7; color: #b45309; }
        .bg-purple-light { background-color: #f3e8ff; color: #7e22ce; }
        .bg-pink-light { background-color: #fce7f3; color: #be185d; }
        .bg-indigo-light { background-color: #e0e7ff; color: #4338ca; }
        .bg-teal-light { background-color: #ccfbf1; color: #0f766e; }
        .bg-orange-light { background-color: #ffedd5; color: #c2410c; }
        .bg-cyan-light { background-color: #cffafe; color: #0e7490; }

        /* File upload styles */
        .file-upload {
            border: 2px dashed var(--light-border);
            border-radius: 12px;
            padding: 2rem;
            text-align: center;
            cursor: pointer;
            transition: border-color 0.3s;
        }

        .file-upload:hover {
            border-color: var(--primary-color);
        }

        .file-upload-icon {
            font-size: 3rem;
            color: #9ca3af;
            margin-bottom: 1rem;
        }

        /* Progress bar styles */
        .progress-container {
            width: 100%;
            background-color: #e5e7eb;
            border-radius: 9999px;
            height: 8px;
            overflow: hidden;
        }

        .progress-bar {
            height: 100%;
            background-color: var(--primary-color);
            border-radius: 9999px;
            transition: width 0.3s ease;
        }

        /* Badge styles */
        .badge {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 600;
            color: white;
        }

        /* Footer styles */
        .footer {
            text-align: center;
            margin-top: 3rem;
            color: #6b7280;
            font-size: 0.875rem;
        }

        /* Utility classes for spacing */
        .space-y-2 > * + * {
            margin-top: 0.5rem;
        }

        .space-y-4 > * + * {
            margin-top: 1rem;
        }

        /* OCR Debug Panel */
        #ocr-debug-panel {
            position: fixed;
            bottom: 0;
            right: 0;
            width: 300px;
            max-height: 300px;
            overflow-y: auto;
            background-color: rgba(0, 0, 0, 0.8);
            color: #fff;
            padding: 10px;
            font-family: monospace;
            font-size: 12px;
            z-index: 1000;
            border-top-left-radius: 8px;
            display: none;
        }

        #ocr-debug-panel.active {
            display: block;
        }

        .debug-entry {
            margin-bottom: 5px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
            padding-bottom: 5px;
        }

        /* OCR Settings Panel */
        #ocr-settings-panel {
            margin-top: 10px;
            padding: 10px;
            background-color: #f3f4f6;
            border-radius: 8px;
            display: none;
        }

        #ocr-settings-panel.active {
            display: block;
        }

        .settings-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .settings-label {
            font-size: 0.875rem;
            font-weight: 500;
        }

        .settings-input {
            width: 60%;
            padding: 4px 8px;
            border: 1px solid var(--light-border);
            border-radius: 4px;
        }

        /* OCR Confidence Indicator */
        .confidence-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 5px;
        }

        .confidence-high {
            background-color: #22c55e;
        }

        .confidence-medium {
            background-color: #f59e0b;
        }

        .confidence-low {
            background-color: #ef4444;
        }

        /* Image enhancement controls */
        .image-controls {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }

        .control-group {
            flex: 1;
            min-width: 120px;
        }

        .control-label {
            display: block;
            font-size: 0.75rem;
            margin-bottom: 4px;
        }

        .control-input {
            width: 100%;
        }

        /* Canvas for image processing */
        #imageProcessingCanvas {
            display: none;
        }

        /* OCR Regions */
        .ocr-region {
            position: absolute;
            border: 2px solid rgba(99, 102, 241, 0.7);
            background-color: rgba(99, 102, 241, 0.1);
            pointer-events: none;
        }

        .image-container {
            position: relative;
            display: inline-block;
        }

        /* Debug toggle button */
        #debug-toggle {
            position: fixed;
            bottom: 10px;
            right: 10px;
            background-color: rgba(0, 0, 0, 0.7);
            color: white;
            border: none;
            border-radius: 4px;
            padding: 5px 10px;
            font-size: 12px;
            cursor: pointer;
            z-index: 1001;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- All pages will be shown/hidden via JavaScript -->
        
        <!-- Home Page -->
        <div id="home-page" class="animate-fade-in">
            <div class="text-center mb-8">
                <h1>BilGer</h1>
                <p class="tagline">Share Bill Together</p>
            </div>

            <div class="grid grid-2 gap-6">
                <div class="card option-card" onclick="navigateTo('scan-struk-page')">
                    <div class="option-icon scan-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="currentColor" viewBox="0 0 16 16">
                            <path d="M10.5 8.5a2.5 2.5 0 1 1-5 0 2.5 2.5 0 0 1 5 0z"/>
                            <path d="M2 4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2h-1.172a2 2 0 0 1-1.414-.586l-.828-.828A2 2 0 0 0 9.172 2H6.828a2 2 0 0 0-1.414.586l-.828.828A2 2 0 0 1 3.172 4H2zm.5 2a.5.5 0 1 1 0-1 .5.5 0 0 1 0 1zm9 2.5a3.5 3.5 0 1 1-7 0 3.5 3.5 0 0 1 7 0z"/>
                        </svg>
                    </div>
                    <h2>Scan Struk</h2>
                    <p class="text-center">Unggah foto struk dan biarkan kami mengekstrak datanya secara otomatis</p>
                </div>

                <div class="card option-card" onclick="navigateTo('input-manual-page')">
                    <div class="option-icon manual-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="currentColor" viewBox="0 0 16 16">
                            <path d="M12.146.146a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1 0 .708l-10 10a.5.5 0 0 1-.168.11l-5 2a.5.5 0 0 1-.65-.65l2-5a.5.5 0 0 1 .11-.168l10-10zM11.207 2.5 13.5 4.793 14.793 3.5 12.5 1.207 11.207 2.5zm1.586 3L10.5 3.207 4 9.707V10h.5a.5.5 0 0 1 .5.5v.5h.5a.5.5 0 0 1 .5.5v.5h.293l6.5-6.5zm-9.761 5.175-.106.106-1.528 3.821 3.821-1.528.106-.106A.5.5 0 0 1 5 12.5V12h-.5a.5.5 0 0 1-.5-.5V11h-.5a.5.5 0 0 1-.468-.325z"/>
                        </svg>
                    </div>
                    <h2>Input Manual</h2>
                    <p class="text-center">Masukkan item dan harga secara manual untuk kontrol lebih detail</p>
                </div>
            </div>

            <div class="footer">
                <p>Dibuat dengan ❤️ untuk memudahkan pembagian tagihan</p>
            </div>
        </div>

        <!-- Scan Struk Page -->
        <div id="scan-struk-page" class="hidden animate-fade-in">
            <button class="btn-back" onclick="navigateTo('home-page')">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                    <path fill-rule="evenodd" d="M11.354 1.646a.5.5 0 0 1 0 .708L5.707 8l5.647 5.646a.5.5 0 0 1-.708.708l-6-6a.5.5 0 0 1 0-.708l6-6a.5.5 0 0 1 .708 0z"/>
                </svg>
                Kembali
            </button>

            <div class="card">
                <h1 class="text-2xl font-bold text-center mb-6">Scan Struk</h1>
                
                <div id="scan-struk-upload" class="mb-6">
                    <div class="file-upload" onclick="document.getElementById('struk-file').click()">
                        <input type="file" id="struk-file" accept="image/*" style="display: none;" onchange="handleStrukUpload(event)">
                        <div class="file-upload-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" fill="currentColor" viewBox="0 0 16 16">
                                <path d="M4.502 9a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3z"/>
                                <path d="M14.002 13a2 2 0 0 1-2 2h-10a2 2 0 0 1-2-2V5A2 2 0 0 1 2 3a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v8a2 2 0 0 1-1.998 2zM14 2H4a1 1 0 0 0-1 1h9.002a2 2 0 0 1 2 2v7A1 1 0 0 0 15 11V3a1 1 0 0 0-1-1zM2.002 4a1 1 0 0 0-1 1v8l2.646-2.354a.5.5 0 0 1 .63-.062l2.66 1.773 3.71-3.71a.5.5 0 0 1 .577-.094l1.777 1.947V5a1 1 0 0 0-1-1h-10z"/>
                            </svg>
                        </div>
                        <p class="mb-4">Unggah foto struk untuk memulai</p>
                        <button class="btn btn-primary">Pilih Gambar</button>
                    </div>
                </div>

                <div id="scan-struk-preview" class="hidden">
                    <div class="mb-4 text-center">
                        <div class="image-container">
                            <img id="struk-preview-image" src="" alt="Preview Struk" class="max-h-96 mx-auto rounded shadow-md">
                            <!-- OCR regions will be added here -->
                        </div>
                    </div>

                    <div id="ocr-settings-panel" class="mb-4">
                        <div class="settings-row">
                            <label class="settings-label" for="price-regex">Regex Harga</label>
                            <input type="text" id="price-regex" class="settings-input" value="(Rp\.?\s?)?(\d{1,3}(\.|\,)\d{3}|\d+)(\,\d{2})?">
                        </div>
                        <div class="settings-row">
                            <label class="settings-label">
                                <input type="checkbox" id="enable-preprocessing" checked> 
                                Aktifkan Preprocessing
                            </label>
                        </div>
                        <div class="settings-row">
                            <button class="btn btn-secondary btn-sm" onclick="toggleDebugPanel()">Toggle Debug</button>
                        </div>
                    </div>
                    
                    <div id="scan-struk-processing" class="hidden space-y-4 mb-4">
                        <p class="text-center">Memproses gambar... <span id="scan-progress">0</span>%</p>
                        <div class="progress-container">
                            <div id="scan-progress-bar" class="progress-bar" style="width: 0%"></div>
                        </div>
                    </div>

                    <div class="flex justify-between">
                        <button class="btn btn-secondary" onclick="resetScanStruk()">Coba Lagi</button>
                        <div>
                            <button class="btn btn-secondary mr-2" onclick="toggleOcrSettings()">Pengaturan</button>
                            <button id="process-struk-btn" class="btn btn-primary" onclick="processStruk()">Proses Gambar</button>
                        </div>
                    </div>
                </div>
            </div>

            <div id="scan-struk-results" class="card hidden">
                <h2 class="text-xl font-bold mb-4">Item Terdeteksi</h2>
                <div id="scan-items-list" class="item-list space-y-2 mb-6">
                    <!-- Items will be added here by JavaScript -->
                </div>
                <div class="flex justify-center">
                    <button class="btn btn-success" onclick="continueToInputPeople('scan')">Lanjutkan</button>
                </div>
            </div>
        </div>

        <!-- Input Manual Page -->
        <div id="input-manual-page" class="hidden animate-fade-in">
            <button class="btn-back" onclick="navigateTo('home-page')">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                    <path fill-rule="evenodd" d="M11.354 1.646a.5.5 0 0 1 0 .708L5.707 8l5.647 5.646a.5.5 0 0 1-.708.708l-6-6a.5.5 0 0 1 0-.708l6-6a.5.5 0 0 1 .708 0z"/>
                </svg>
                Kembali
            </button>

            <div class="card">
                <h1 class="text-2xl font-bold text-center mb-6">Input Manual</h1>
                
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                    <div class="md:col-span-2">
                        <div class="form-group">
                            <label for="item-name" class="form-label">Nama Item</label>
                            <input type="text" id="item-name" class="form-input" placeholder="Contoh: Nasi Goreng">
                        </div>
                    </div>
                    <div>
                        <div class="form-group">
                            <label for="item-price" class="form-label">Harga (Rp)</label>
                            <input type="text" id="item-price" class="form-input" placeholder="25000" onkeyup="formatPrice(this)">
                        </div>
                    </div>
                </div>

                <div class="flex justify-center mb-6">
                    <button id="add-item-btn" class="btn btn-primary" onclick="addManualItem()">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16" style="margin-right: 8px;">
                            <path d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z"/>
                        </svg>
                        Tambah Item
                    </button>
                </div>
            </div>

            <div id="manual-items-card" class="card hidden">
                <h2 class="text-xl font-bold mb-4">Daftar Item</h2>
                <div id="manual-items-list" class="item-list space-y-2 mb-6">
                    <!-- Items will be added here by JavaScript -->
                </div>
                <div class="flex justify-between items-center">
                    <div class="text-lg font-bold">
                        Total: Rp <span id="manual-total">0</span>
                    </div>
                    <button class="btn btn-success" onclick="continueToInputPeople('manual')">Lanjutkan</button>
                </div>
            </div>
        </div>

        <!-- Input People Page -->
        <div id="input-people-page" class="hidden animate-fade-in">
            <button class="btn-back" onclick="navigateTo('scan-struk-page')">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                    <path fill-rule="evenodd" d="M11.354 1.646a.5.5 0 0 1 0 .708L5.707 8l5.647 5.646a.5.5 0 0 1-.708.708l-6-6a.5.5 0 0 1 0-.708l6-6a.5.5 0 0 1 .708 0z"/>
                </svg>
                Kembali
            </button>

            <div class="card">
                <h1 class="text-2xl font-bold text-center mb-6">Siapa yang Membayar?</h1>
                
                <div class="form-group mb-6">
                    <label for="number-of-people" class="form-label">Jumlah Orang</label>
                    <input type="number" id="number-of-people" class="form-input" min="1" max="10" value="2" onchange="updatePeopleInputs()">
                </div>

                <div class="mb-6">
                    <h2 class="text-xl font-medium mb-4">Nama Orang</h2>
                    <div id="people-inputs" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <!-- People inputs will be added here by JavaScript -->
                    </div>
                </div>
            </div>

            <div class="card">
                <h2 class="text-xl font-bold mb-4">Ringkasan Tagihan</h2>
                <div id="bill-summary-list" class="item-list space-y-2 mb-4">
                    <!-- Items will be added here by JavaScript -->
                </div>
                <div class="flex justify-between items-center border-t border-gray-200 pt-4">
                    <div class="text-lg font-bold">
                        Total: Rp <span id="bill-total">0</span>
                    </div>
                    <button class="btn btn-success" onclick="continueToBillSplitter()">Lanjutkan</button>
                </div>
            </div>
        </div>

        <!-- Bill Splitter Page -->
        <div id="bill-splitter-page" class="hidden animate-fade-in">
            <button class="btn-back" onclick="navigateTo('input-people-page')">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                    <path fill-rule="evenodd" d="M11.354 1.646a.5.5 0 0 1 0 .708L5.707 8l5.647 5.646a.5.5 0 0 1-.708.708l-6-6a.5.5 0 0 1 0-.708l6-6a.5.5 0 0 1 .708 0z"/>
                </svg>
                Kembali
            </button>

            <div class="card">
                <h1 class="text-2xl font-bold text-center mb-6">Pembagian Tagihan</h1>
                
                <div class="mb-6">
                    <h2 class="text-xl font-medium mb-4">Pilih Siapa yang Membayar</h2>
                    <div id="people-avatars" class="flex flex-wrap gap-3 justify-center">
                        <!-- People avatars will be added here by JavaScript -->
                    </div>
                    
                    <div id="active-person-instruction" class="mt-4 text-center hidden">
                        Klik item di bawah untuk mengalokasikan ke <span id="active-person-name"></span>
                    </div>
                </div>

                <div class="space-y-4">
                    <div class="flex justify-between items-center">
                        <h2 class="text-xl font-medium">Daftar Item</h2>
                        <div class="text-sm text-gray-600">
                            <span id="allocated-count">0</span> dari <span id="total-items-count">0</span> item dialokasikan
                        </div>
                    </div>
                    
                    <div id="bill-items-list" class="item-list space-y-3">
                        <!-- Items will be added here by JavaScript -->
                    </div>
                </div>
            </div>

            <div class="card">
                <h2 class="text-xl font-bold mb-4">Ringkasan Pembayaran</h2>
                
                <div id="payment-summary" class="space-y-3 mb-6">
                    <!-- Payment summary will be added here by JavaScript -->
                </div>

                <div class="flex justify-between items-center border-t border-gray-200 pt-4">
                    <div class="text-lg font-bold">
                        Total: Rp <span id="splitter-total">0</span>
                    </div>
                    <button id="finish-btn" class="btn btn-success" onclick="finishSplitting()">Selesai</button>
                </div>
            </div>
        </div>

        <!-- Results Page -->
        <div id="results-page" class="hidden animate-fade-in">
            <div class="card">
                <div class="text-center mb-8">
                    <h1 class="text-2xl font-bold mb-2">Pembagian Selesai!</h1>
                    <p class="text-gray-600">Berikut adalah rincian pembayaran untuk setiap orang</p>
                </div>

                <div id="results-grid" class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- Results will be added here by JavaScript -->
                </div>
            </div>

            <div class="card">
                <div class="flex justify-between items-center">
                    <div class="text-lg font-bold">
                        Total Tagihan: Rp <span id="results-total">0</span>
                    </div>
                    <button class="btn btn-primary" onclick="startNew()">Mulai Baru</button>
                </div>
            </div>

            <div class="footer">
                <p>BilGer - Share Bill Together</p>
                <p class="text-sm mt-1">Dibuat dengan ❤️ untuk memudahkan pembagian tagihan</p>
            </div>
        </div>
    </div>

    <!-- Canvas for image processing -->
    <canvas id="imageProcessingCanvas" width="0" height="0"></canvas>

    <!-- OCR Debug Panel -->
    <div id="ocr-debug-panel"></div>
    <button id="debug-toggle" onclick="toggleDebugPanel()" style="display: none;">Debug</button>

    <!-- Tesseract.js library -->
    <script src="https://cdn.jsdelivr.net/npm/tesseract.js@5.0.3/dist/tesseract.min.js"></script>

    <script>
        // Global state
        let state = {
            currentPage: 'home-page',
            previousPage: null,
            items: [],
            people: [
                { id: 1, name: '' },
                { id: 2, name: '' }
            ],
            activePersonId: null,
            sourceType: null, // 'scan' or 'manual'
            ocrWorker: null,
            ocrDebug: false,
            originalImage: null,
            enhancedImage: null,
            ocrResults: null,
            ocrRegions: []
        };

        // Colors for person avatars and cards
        const colors = [
            'red', 'blue', 'green', 'yellow', 'purple', 
            'pink', 'indigo', 'teal', 'orange', 'cyan'
        ];

        // Initialize the app
        document.addEventListener('DOMContentLoaded', function() {
            // Set up initial people inputs
            updatePeopleInputs();
        });

        // Navigation functions
        function navigateTo(pageId) {
            // Hide all pages
            document.querySelectorAll('.container > div').forEach(page => {
                page.classList.add('hidden');
            });
            
            // Show the target page
            document.getElementById(pageId).classList.remove('hidden');
            
            // Update state
            state.previousPage = state.currentPage;
            state.currentPage = pageId;
        }

        function goBack() {
            if (state.previousPage) {
                navigateTo(state.previousPage);
            } else {
                navigateTo('home-page');
            }
        }

        // Scan Struk functions
        function handleStrukUpload(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const img = new Image();
                    img.onload = function() {
                        state.originalImage = img;
                        document.getElementById('struk-preview-image').src = e.target.result;
                        document.getElementById('scan-struk-upload').classList.add('hidden');
                        document.getElementById('scan-struk-preview').classList.remove('hidden');
                    };
                    img.src = e.target.result;
                    const base64string = e.target.result
                    state.base64 = base64string.split(',')[1];
                };
                reader.readAsDataURL(file);
            }
        }

        function resetScanStruk() {
            document.getElementById('struk-file').value = '';
            document.getElementById('scan-struk-upload').classList.remove('hidden');
            document.getElementById('scan-struk-preview').classList.add('hidden');
            document.getElementById('scan-struk-processing').classList.add('hidden');
            document.getElementById('scan-struk-results').classList.add('hidden');
            document.getElementById('scan-progress').textContent = '0';
            document.getElementById('scan-progress-bar').style.width = '0%';
            
            // Reset state
            state.items = [];
            state.originalImage = null;
            state.enhancedImage = null;
            state.ocrResults = null;
            state.calcDone = false;
        }

        function toggleOcrSettings() {
            const settingsPanel = document.getElementById('ocr-settings-panel');
            settingsPanel.classList.toggle('active');
        }

        function toggleDebugPanel() {
            state.ocrDebug = !state.ocrDebug;
            const debugPanel = document.getElementById('ocr-debug-panel');
            debugPanel.classList.toggle('active');
            document.getElementById('debug-toggle').style.display = state.ocrDebug ? 'block' : 'none';
        }

        function logDebug(message) {
            if (state.ocrDebug) {
                const debugPanel = document.getElementById('ocr-debug-panel');
                const entry = document.createElement('div');
                entry.className = 'debug-entry';
                entry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
                debugPanel.appendChild(entry);
                debugPanel.scrollTop = debugPanel.scrollHeight;
            }
            console.log(message);
        }

        async function processStruk() {
            //start working from here

            state.calcDone = false;
            if (!state.originalImage) return;
            
            // Show processing UI
            document.getElementById('scan-struk-processing').classList.remove('hidden');
            document.getElementById('process-struk-btn').disabled = true;
            
            // Reset progress
            let progress = 0;
            document.getElementById('scan-progress').textContent = progress;
            document.getElementById('scan-progress-bar').style.width = `${progress}%`;
            
            const fileInput = document.getElementById('struk-file');
            const formData = new FormData();
            formData.append('image', fileInput.files[0]);

            try {
                const response = await fetch('http://localhost:5000/ocr', {
                method: 'POST',
                body: formData
                })
                .then(
                    response => response.json()
                )
                .then(data => {
                    extractItemsFromOcr(data)
                    displayScanItems();
                    document.getElementById('scan-struk-results').classList.remove('hidden');
                });
                
                
            } catch (error) {
                logDebug('Error during OCR processing: ' + error.message);
                console.error('Error during OCR processing:', error);
                alert('Terjadi kesalahan saat memproses gambar. Silakan coba lagi.');
            } finally {
                // Complete progress
                document.getElementById('scan-progress').textContent = '100';
                document.getElementById('scan-progress-bar').style.width = '100%';
                
                // Re-enable button
                document.getElementById('process-struk-btn').disabled = false;
            }
        }

        function extractItemsFromOcr(result) {
           state.discount = result.discount != null ? result.discount : 0
           state.totalPrice = result.total != null ? result.total : 0
           state.subTotal = result.subtotal != null ? result.subtotal : 0
           state.tax = result.tax != null ? result.tax : 0
            
           var items = []
           var subtotal = 0
           var total = 0
           state.taxIncluded = false
           state.discountIncluded = false

            result.items.forEach(item => {
                items.push({
                    name: item.name,
                    price: item.price * item.quantity,
                    quantity: item.quantity
                })
                subtotal += item.price * item.quantity
            })

            if(subtotal != state.subTotal) {
                state.subTotal = subtotal
            }

            if(state.totalPrice > state.subTotal) {
                if(state.tax != state.totalPrice - state.subTotal){
                    state.tax = state.totalPrice - state.subTotal
                }
                state.discountIncluded = true
            } else if (state.totalPrice < state.subTotal) {
                if(state.discount != state.subTotal - state.totalPrice){
                    state.discount = state.subTotal - state.totalPrice
                }
                state.taxIncluded = true
            } else {
                state.taxIncluded = true
                state.discountIncluded = true
            }

            state.items = items.map(item => ({
                ...item,
                assignedTo: []
            }));
        }

        function displayScanItems() {
            const itemsList = document.getElementById('scan-items-list');
            itemsList.innerHTML = '';
            
            if (state.items.length === 0) {
                itemsList.innerHTML = '<div class="p-4 text-center text-gray-500">Tidak ada item yang terdeteksi. Silakan coba lagi dengan gambar yang lebih jelas.</div>';
                return;
            }
            
            state.items.forEach((item, index) => {
                const confidenceClass = 'confidence-high'
                
                const itemElement = document.createElement('div');
                itemElement.className = 'item';
                itemElement.innerHTML = `
                    <div class="flex items-center">
                        <span class="confidence-indicator ${confidenceClass}" title="Confidence: ${item.confidence?.toFixed(1) || 0}%"></span>
                        <span class="item-name">${item.quantity} x ${item.name}</span>
                    </div>
                    <span class="item-price">Rp ${formatNumber(item.price)}</span>
                `;
                itemsList.appendChild(itemElement);
            });

            const discountHolder = document.createElement('div');
            discountHolder.className = 'item';
            discountHolder.innerHTML = `
                <div class="flex items-center">
                    <span class="item-name">Discount</span>
                </div>
                <span class="item-price">Rp ${formatNumber(state.discount)}</span>
            `;
            itemsList.appendChild(discountHolder);
            
            const taxHolder = document.createElement('div');
            taxHolder.className = 'item';
            taxHolder.innerHTML = `
                <div class="flex items-center">
                    <span class="item-name">Tax</span>
                </div>
                <span class="item-price">Rp ${formatNumber(state.tax)}</span>
            `;
            itemsList.appendChild(taxHolder);
        }

        // Input Manual functions
        function formatPrice(input) {
            // Remove non-numeric characters
            let value = input.value.replace(/\D/g, '');
            // Format with thousand separators
            if (value) {
                value = parseInt(value).toLocaleString('id-ID');
            }
            input.value = value;
        }

        function addManualItem() {
            const nameInput = document.getElementById('item-name');
            const priceInput = document.getElementById('item-price');
            
            const name = nameInput.value.trim();
            const priceText = priceInput.value.replace(/\./g, '');
            const price = parseInt(priceText);
            
            if (name && !isNaN(price) && price > 0) {
                // Add item to state
                state.items.push({
                    name: name,
                    price: price,
                    assignedTo: []
                });
                
                // Clear inputs
                nameInput.value = '';
                priceInput.value = '';
                nameInput.focus();
                
                // Display items
                displayManualItems();
                
                // Show items card if hidden
                document.getElementById('manual-items-card').classList.remove('hidden');
                
                // Set source type
                state.sourceType = 'manual';
            }
        }

        function displayManualItems() {
            const itemsList = document.getElementById('manual-items-list');
            itemsList.innerHTML = '';
            
            let total = 0;
            
            state.items.forEach((item, index) => {
                total += item.price;
                
                const itemElement = document.createElement('div');
                itemElement.className = 'item';
                itemElement.innerHTML = `
                    <span class="item-name">${item.name}</span>
                    <div class="flex items-center">
                        <span class="item-price mr-3">Rp ${formatNumber(item.price)}</span>
                        <button class="text-red-500 hover:text-red-700" onclick="removeManualItem(${index})">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                                <path d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0V6z"/>
                                <path fill-rule="evenodd" d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1v1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4H4.118zM2.5 3V2h11v1h-11z"/>
                            </svg>
                        </button>
                    </div>
                `;
                itemsList.appendChild(itemElement);
            });
            
            // Update total
            document.getElementById('manual-total').textContent = formatNumber(total);
        }

        function removeManualItem(index) {
            state.items.splice(index, 1);
            displayManualItems();
            
            // Hide items card if no items
            if (state.items.length === 0) {
                document.getElementById('manual-items-card').classList.add('hidden');
            }
        }

        // Input People functions
        function updatePeopleInputs() {
            const count = parseInt(document.getElementById('number-of-people').value);
            const container = document.getElementById('people-inputs');
            container.innerHTML = '';
            
            // Update state with new people count
            if (count > state.people.length) {
                // Add new people
                for (let i = state.people.length + 1; i <= count; i++) {
                    state.people.push({ id: i, name: '' });
                }
            } else if (count < state.people.length) {
                // Remove excess people
                state.people = state.people.slice(0, count);
            }
            
            // Create input fields
            state.people.forEach(person => {
                const inputGroup = document.createElement('div');
                inputGroup.className = 'animate-fade-in';
                inputGroup.innerHTML = `
                    <label for="person-${person.id}" class="form-label">Orang ${person.id}</label>
                    <input type="text" id="person-${person.id}" class="form-input" 
                           placeholder="Nama orang ${person.id}" 
                           value="${person.name}"
                           onchange="updatePersonName(${person.id}, this.value)">
                `;
                container.appendChild(inputGroup);
            });
            
            // Update bill summary
            updateBillSummary();
        }

        function updatePersonName(id, name) {
            const person = state.people.find(p => p.id === id);
            if (person) {
                person.name = name;
            }
        }

        function updateBillSummary() {
            const itemsList = document.getElementById('bill-summary-list');
            itemsList.innerHTML = '';
            
            let total = 0;
            
            state.items.forEach(item => {
                console.log(state.calcDone)
                var newPrice = item.price
                
                if(!state.taxIncluded && !state.calcDone) {
                    const share = item.price / state.subTotal
                    newPrice = item.price += Math.round(share * state.tax)
                }

                if(!state.discountIncluded && !state.calcDone) {
                    const share = item.price / state.subTotal
                    newPrice = item.price -= Math.round(share * state.discount)
                }
                
                total += newPrice;

                const itemElement = document.createElement('div');
                itemElement.className = 'item';
                itemElement.innerHTML = `
                    <span class="item-name">${item.name}</span>
                    <span class="item-price">Rp ${formatNumber(newPrice)}</span>
                `;
                itemsList.appendChild(itemElement);
            });
           
            // Update total
            document.getElementById('bill-total').textContent = formatNumber(total);
            state.calcDone = true
        }

        function continueToInputPeople(sourceType) {
            state.sourceType = sourceType;
            updateBillSummary();
            navigateTo('input-people-page');
        }

        // Bill Splitter functions
        function continueToBillSplitter() {
            // Validate that all people have names
            const allNamesProvided = state.people.every(person => person.name.trim() !== '');
            
            if (!allNamesProvided) {
                alert('Harap isi nama untuk semua orang');
                return;
            }
            
            // Set up bill splitter page
            setupBillSplitter();
            navigateTo('bill-splitter-page');
        }

        function setupBillSplitter() {
            // Set up people avatars
            setupPeopleAvatars();
            
            // Set up bill items
            setupBillItems();
            
            // Update payment summary
            updatePaymentSummary();
            
            // Update allocated count
            updateAllocatedCount();
            
            // Update total
            const total = state.items.reduce((sum, item) => sum + item.price, 0);
            document.getElementById('splitter-total').textContent = formatNumber(total);
        }

        function setupPeopleAvatars() {
            const container = document.getElementById('people-avatars');
            container.innerHTML = '';
            
            state.people.forEach(person => {
                const colorIndex = (person.id - 1) % colors.length;
                const color = colors[colorIndex];
                
                const personCard = document.createElement('div');
                personCard.className = `person-card bg-${color}-light ${state.activePersonId === person.id ? 'active' : ''}`;
                personCard.onclick = () => selectPerson(person.id);
                personCard.innerHTML = `
                    <div class="person-avatar bg-${color}">
                        ${person.name.charAt(0).toUpperCase()}
                    </div>
                    <span class="text-sm font-medium">${person.name}</span>
                `;
                container.appendChild(personCard);
            });
        }

        function selectPerson(personId) {
            if (state.activePersonId === personId) {
                // Deselect if already selected
                state.activePersonId = null;
                document.getElementById('active-person-instruction').classList.add('hidden');
            } else {
                // Select new person
                state.activePersonId = personId;
                const person = state.people.find(p => p.id === personId);
                document.getElementById('active-person-name').textContent = person.name;
                document.getElementById('active-person-instruction').classList.remove('hidden');
            }
            
            // Update UI
            setupPeopleAvatars();
        }

        function setupBillItems() {
            const container = document.getElementById('bill-items-list');
            container.innerHTML = '';
            document.getElementById('total-items-count').textContent = state.items.length;
            
            state.items.forEach((item, index) => {
                const itemElement = document.createElement('div');
                itemElement.className = 'flex flex-col p-4 rounded cursor-pointer transition-all ' + 
                                       (item.assignedTo.length > 0 ? 'bg-gray-50' : 'bg-white border border-gray-200');
                itemElement.onclick = () => assignItemToPerson(index);
                
                let assignedHTML = '';
                if (item.assignedTo.length > 0) {
                    assignedHTML = '<div class="flex flex-wrap gap-2 mt-2">';
                    item.assignedTo.forEach(personId => {
                        const person = state.people.find(p => p.id === personId);
                        const colorIndex = (personId - 1) % colors.length;
                        const color = colors[colorIndex];
                        
                        if (person) {
                            const pricePerPerson = item.price / item.assignedTo.length;
                            assignedHTML += `
                                <div class="badge bg-${color}">
                                    ${person.name} 
                                    ${item.assignedTo.length > 1 ? `(Rp ${formatNumber(pricePerPerson)})` : ''}
                                </div>
                            `;
                        }
                    });
                    assignedHTML += '</div>';
                }
                
                itemElement.innerHTML = `
                    <div class="flex justify-between items-center mb-2">
                        <span class="font-medium">${item.name}</span>
                        <span class="font-bold">Rp ${formatNumber(item.price)}</span>
                    </div>
                    ${assignedHTML}
                `;
                container.appendChild(itemElement);
            });
        }

        function assignItemToPerson(itemIndex) {
            if (state.activePersonId !== null) {
                const item = state.items[itemIndex];
                const personIndex = item.assignedTo.indexOf(state.activePersonId);
                
                if (personIndex === -1) {
                    // Add person to this item
                    item.assignedTo.push(state.activePersonId);
                } else {
                    // Remove person from this item
                    item.assignedTo.splice(personIndex, 1);
                }
                
                // Update UI
                setupBillItems();
                updatePaymentSummary();
                updateAllocatedCount();
            }
        }

        function updatePaymentSummary() {
            const container = document.getElementById('payment-summary');
            container.innerHTML = '';
            
            state.people.forEach(person => {
                const total = calculatePersonTotal(person.id);
                const colorIndex = (person.id - 1) % colors.length;
                const color = colors[colorIndex];
                
                const summaryElement = document.createElement('div');
                summaryElement.className = `flex justify-between items-center p-3 rounded-lg bg-${color}-light`;
                summaryElement.innerHTML = `
                    <span class="font-medium">${person.name}</span>
                    <span class="font-bold">Rp ${formatNumber(total)}</span>
                `;
                container.appendChild(summaryElement);
            });
        }

        function calculatePersonTotal(personId) {
            return state.items.reduce((total, item) => {
                const assignedCount = item.assignedTo.length;
                if (assignedCount > 0 && item.assignedTo.includes(personId)) {
                    return total + (item.price / assignedCount);
                }
                return total;
            }, 0);
        }

        function updateAllocatedCount() {
            const allocatedCount = state.items.reduce((count, item) => {
                return count + (item.assignedTo.length > 0 ? 1 : 0);
            }, 0);
            
            document.getElementById('allocated-count').textContent = allocatedCount;
            
            // Enable/disable finish button
            document.getElementById('finish-btn').disabled = allocatedCount < state.items.length;
        }

        function finishSplitting() {
            // Check if all items are assigned
            const allItemsAssigned = state.items.every(item => item.assignedTo.length > 0);
            
            if (allItemsAssigned) {
                setupResultsPage();
                navigateTo('results-page');
            } else {
                alert('Harap alokasikan semua item ke setidaknya satu orang');
            }
        }

        // Results Page functions
        function setupResultsPage() {
            const container = document.getElementById('results-grid');
            container.innerHTML = '';
            
            const totals = state.people.map(person => ({
                personId: person.id,
                personName: person.name,
                total: calculatePersonTotal(person.id)
            }));
            
            totals.forEach((personTotal, index) => {
                const colorIndex = (personTotal.personId - 1) % colors.length;
                const color = colors[colorIndex];
                
                const resultCard = document.createElement('div');
                resultCard.className = 'bg-white dark:bg-gray-700 rounded-xl shadow-md overflow-hidden animate-fade-in';
                resultCard.style.animationDelay = `${index * 0.1}s`;
                
                const items = getItemsForPerson(personTotal.personId);
                let itemsHTML = '';
                
                items.forEach(item => {
                    itemsHTML += `
                        <div class="flex justify-between items-center p-2 bg-gray-50 rounded-lg mb-2">
                            <span>${item.name}</span>
                            <span class="font-medium">Rp ${formatNumber(item.price)}</span>
                        </div>
                    `;
                });
                
                resultCard.innerHTML = `
                    <div class="p-4 bg-${color} text-white">
                        <div class="flex items-center">
                            <div class="w-12 h-12 rounded-full bg-white flex items-center justify-center text-xl font-bold mr-4">
                                <span class="text-${color}-700">${personTotal.personName.charAt(0).toUpperCase()}</span>
                            </div>
                            <div>
                                <h3 class="text-xl font-bold">${personTotal.personName}</h3>
                                <p class="text-2xl font-bold mt-1">Rp ${formatNumber(personTotal.total)}</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="p-4">
                        <h4 class="font-medium mb-3">Rincian Item:</h4>
                        <div class="space-y-2 max-h-48 overflow-y-auto">
                            ${itemsHTML}
                        </div>
                    </div>
                `;
                
                container.appendChild(resultCard);
            });
            
            // Update total
            const total = state.items.reduce((sum, item) => sum + item.price, 0);
            document.getElementById('results-total').textContent = formatNumber(total);
        }

        function getItemsForPerson(personId) {
            return state.items
                .filter(item => item.assignedTo.includes(personId))
                .map(item => ({
                    name: item.name,
                    price: item.assignedTo.length > 1 
                        ? item.price / item.assignedTo.length 
                        : item.price
                }));
        }

        function startNew() {
            // Reset state
            state = {
                currentPage: 'home-page',
                previousPage: null,
                items: [],
                people: [
                    { id: 1, name: '' },
                    { id: 2, name: '' }
                ],
                activePersonId: null,
                sourceType: null,
                ocrWorker: state.ocrWorker,
                ocrDebug: state.ocrDebug,
                originalImage: null,
                enhancedImage: null,
                ocrResults: null,
                ocrRegions: []
            };
            
            // Reset UI
            document.getElementById('number-of-people').value = 2;
            updatePeopleInputs();
            resetScanStruk();
            document.getElementById('item-name').value = '';
            document.getElementById('item-price').value = '';
            document.getElementById('manual-items-card').classList.add('hidden');
            
            // Navigate to home
            navigateTo('home-page');
        }

        // Utility functions
        function formatNumber(number) {
            return Math.round(number).toLocaleString('id-ID');
        }

        // Clean up resources when page is unloaded
        window.addEventListener('beforeunload', async () => {
            if (state.ocrWorker) {
                await state.ocrWorker.terminate();
            }
        });
    </script>
</body>
</html>
